<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Couple Love Arcade ðŸ’œ</title>

<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(135deg,#140021,#2a003d,#3d0066);
  color:white;
  text-align:center;
}
button{
  padding:10px 18px;
  border:none;
  border-radius:20px;
  cursor:pointer;
  background:linear-gradient(45deg,#a020f0,#ff4dff);
  color:white;
  margin:5px;
}
.board{
  display:grid;
  grid-template-columns:repeat(3,80px);
  gap:10px;
  justify-content:center;
  margin:20px;
}
.cell{
  width:80px;height:80px;
  background:#1a002b;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:28px;
  border-radius:12px;
  cursor:pointer;
}
#chatBox{
  height:200px;
  overflow:auto;
  background:#1a002b;
  margin:10px;
  padding:10px;
  border-radius:10px;
}
.message{margin:5px 0;}
.sent{text-align:right;}
.pixel-heart{
  position:fixed;
  font-size:14px;
  animation:floatUp 4s linear forwards;
}
@keyframes floatUp{
  0%{transform:translateY(0);opacity:1;}
  100%{transform:translateY(-200px);opacity:0;}
}
</style>
</head>
<body>

<h2>ðŸ’œ Couple Love Arcade ðŸ’œ</h2>

<div id="menu">
<input id="roomInput" placeholder="Room Code">
<button onclick="joinRoom()">Join</button>
</div>

<div id="game" style="display:none;">
<h3 id="turn"></h3>
<div class="board" id="board"></div>

<button onclick="sendTD()">Truth or Dare</button>
<p id="td"></p>

<div id="chatBox"></div>
<div id="typing"></div>

<input id="msgInput" placeholder="Type..." oninput="typing()">
<button onclick="sendMsg()">Send</button>
</div>

<script>
const socket = io({ path: "/api/socket" });

let room="";
let player="X";
let turn="X";
let board=["","","","","","","","",""];

function joinRoom(){
  room=document.getElementById("roomInput").value;
  socket.emit("joinRoom",room);
  document.getElementById("menu").style.display="none";
  document.getElementById("game").style.display="block";
  initBoard();
}

function initBoard(){
  const b=document.getElementById("board");
  b.innerHTML="";
  board.forEach((v,i)=>{
    const d=document.createElement("div");
    d.className="cell";
    d.onclick=()=>makeMove(i);
    b.appendChild(d);
  });
}

function makeMove(i){
  if(board[i]!=""||turn!==player)return;
  board[i]=player;
  socket.emit("move",{room,i,player});
}

socket.on("move",data=>{
  board[data.i]=data.player;
  turn=data.player==="X"?"O":"X";
  updateBoard();
});

function updateBoard(){
  document.querySelectorAll(".cell")
  .forEach((c,i)=>c.innerText=board[i]);
  document.getElementById("turn").innerText="Turn: "+turn;
}

function sendMsg(){
  const text=document.getElementById("msgInput").value;
  socket.emit("chat",{room,text});
  document.getElementById("msgInput").value="";
}

socket.on("chat",data=>{
  const d=document.createElement("div");
  d.className="message";
  d.innerText=data.text;
  document.getElementById("chatBox").appendChild(d);
});

function typing(){
  socket.emit("typing",{room});
}

socket.on("typing",()=>{
  document.getElementById("typing").innerText="Typing... ðŸ’œ";
  setTimeout(()=>document.getElementById("typing").innerText="",1000);
});

function sendTD(){
  const list=["Describe our wedding ðŸ’","Say 3 cute things ðŸ’•"];
  const r=list[Math.floor(Math.random()*list.length)];
  socket.emit("truthDare",{room,text:r});
}

socket.on("truthDare",data=>{
  document.getElementById("td").innerText=data.text;
});

function spawnHeart(){
  const h=document.createElement("div");
  h.className="pixel-heart";
  h.innerText="ðŸ’œ";
  h.style.left=Math.random()*window.innerWidth+"px";
  h.style.bottom="0px";
  document.body.appendChild(h);
  setTimeout(()=>h.remove(),4000);
}
setInterval(spawnHeart,1500);
</script>

</body>
</html>
